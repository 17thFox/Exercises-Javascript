<!DOCTYPE html>
<html>

<head>
    <style type="text/css">
        ul {
            list-style-type: none;
        }
        
        li {
            margin: 0 0 5px 0;
        }
    </style>
</head>

<body>

    <h1>Hello World!</h1>

    <input type="text" id="searchInput" name="example" placeholder="ex. Narnia...">
    <ul class="dropdown" id="dropdown"></ul>




    <div id="container">
        <h3 class="results">Your total results will show here!</h3>
        <ul class="movie_details">
        </ul>
    </div>

</body>

<script src="https://code.jquery.com/jquery-3.1.1.js" integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA=" crossorigin="anonymous"></script>

<script type="text/javascript" src="js/index.js"></script>

<script>
    function debounce(func, wait, immediate) {

        var timeout;

        return function() {

            var context = this,
                args = arguments;

            var callNow = immediate && !timeout;

            clearTimeout(timeout);

            timeout = setTimeout(function() {
                timeout = null;

                if (!immediate) {
                    func.apply(context, args);
                }
            }, wait);

            if (callNow) func.apply(context, args);
        };
    };



    $Container = $('#container');
    $Movies = $('.movie_details');
    $Movies.hide();



    $('#searchInput').on('keyup', debounce(function(event) {
        event.preventDefault();
        var mySearchInput = $('#searchInput').val();
        if (mySearchInput.length >= 3) {
            $.ajax({
                    method: "POST",
                    url: "/search/movie/",
                    data: {
                        movie: mySearchInput
                    },
                })
                .done(function(data) {
                    $Movies.empty();
                    var myLength = data.length;
                    $Container.find('.results').text('You recieved: ' + myLength + ' results.').css('color', 'black');

                    for (var i = 0; i < myLength; i++) {
                        console.log(data[i].Title);
                        if (data[i].Poster == 'N/A') {
                            $Movies.append(
                                "<li>" + data[i].Title + " (" + data[i].Year + ")  (" + data[i].Type + ")  "
                            )
                        } else {
                            $Movies.append(
                                "<li>" + data[i].Title + " (" + data[i].Year + ")  (" + data[i].Type + ")  " +
                                "<img src=" + data[i].Poster + " height = '100' /> </li>"
                            )
                        }
                    }
                    $Movies.show();
                });

        } else {
            $Container.find('.results').text('You must enter at least 3 letters!').css('color', 'red');

        }
    }, 400));




    // Beginning for dropdown search!


    // var changingInput = '';
    // var $willChange = $("#searchInput");
    // var currentIndex = 0;
    // var ddopened = 0;
    // var visIndex = 0;


    // $("#searchInput").on('keyup', function (event){
    // 	changingInput += $('#searchInput').val();
    // 	for(var i = 0; i < myLength; i++){
    // 		if(data[i].Title.includes(changingInput)){
    // 			var li = document.createElement("li");
    // 	  		li.appendChild(document.createTextNode(data[i].Title));

    // 	  		continue;
    // 		}
    // 	}
    // }
</script>

</html>